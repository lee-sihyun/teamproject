
<%@page import="site.itwill.dao.QnADAO"%>
<%@page import="site.itwill.dto.QnADTO"%>
<%@page import="site.itwill.dto.LushUserDTO"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%-- 게시글 번호를 전달받아 QnA 테이블에 저장된 게시글을 검색하여 응답하는 JSP 문서 --%>
<%-- => [글삭제]를 클릭한 경우 게시글 삭제 처리페이지(QnA_remove_action.jsp)로 이동 --%>
<%-- => [글변경]을 클릭한 경우 게시글 변경 입력페이지(QnA_modify.jsp)로 이동 --%>
<%-- => [답글쓰기]를 클릭한 경우 게시글 입력페이지(QnA_write.jsp)로 이동 --%>
<%-- => [게시글목록]을 클릭한 경우 게시글 목록 출력페이지(QnA_list.jsp)로 이동 --%>
<%
	//비정상적인 요청에 대한 응답 처리
	// => 전달값이 존재하지 않을 경우	
	if(request.getParameter("num")==null) {
		out.println("<script>");
		out.println("location.href='"+request.getContextPath()+"/index.jsp?workgroup=board/QnA&work=QnA_list';");
		out.println("</script>");
		return;
	}
	
	//전달값을 반환받아 저장
	int num=Integer.parseInt(request.getParameter("num"));
	String pageNum=request.getParameter("pageNum");
	
	//게시글 번호를 전달하여 QnA 테이블에 저장된 게시글을 검색하여 반환하는 DAO 클래스의 메소드 호출
	QnADTO QnA=QnADAO.getDAO().getQnA(num);
	
	//비정상적인 요청에 대한 응답 처리
	// => 검색된 게시글이 없거나 삭제된 게시글인 경우
	if(QnA==null || QnA.getStatus()==9) {
		out.println("<script>");
		out.println("location.href='"+request.getContextPath()+"/index.jsp?workgroup=board/QnA&work=QnA_list';");
		out.println("</script>");
		return;
	}

	//세션으로 공유된 인증정보를 반환받아 저장
	LushUserDTO loginUser=(LushUserDTO)session.getAttribute("loginUser");
	
	//검색되어 반환된 게시글이 비밀글인 경우
	if(QnA.getStatus()==1) {
		//비정상적인 요청에 대한 응답 처리
		// => 현재 로그인 사용자가 작성자가 아니거나 관리자인 아닌 경우
		if(loginUser==null || !loginUser.getId().equals(QnA.getId()) && loginUser.getStatus()!=9) {
			out.println("<script>");
			out.println("location.href='"+request.getContextPath()+"/index.jsp?workgroup=board/QnA&work=QnA_list';");
			out.println("</script>");
			return;			
		}
	}
%> 
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<style type="text/css">
#wrapper {
	width: 500px;
	margin: 0 auto;
}

table {
	border: 1px solid black;
	border-collapse: collapse; 
}

th, td {
	border: 1px solid black;
	padding: 5px;
}

th { width: 100px; }

td { width: 400px; }

.subject, .content { text-align: left; }

.content {
	height: 100px;
	vertical-align: middle;
}

#QnA_menu {
	text-align: right;
	margin: 5px;
}
</style>

<div id="wrapper">
	<h2>게시글</h2>
	<table>
		<tr>
			<th>아이디</th>
			<td>
				<%=QnA.getId() %>
								
			</td>
		</tr>
		<tr>
			<th>작성일</th>
			<td><%=QnA.getRegDate().substring(0, 19) %></td>
		</tr>
		<tr>
			<th>제목</th>
			<td class="title">
				<%=QnA.getTitle() %>
			</td>
		</tr>
		<tr>
			<th>카테고리</th>
			<td class="category">
				<%=QnA.getCategory() %>
			</td>
		</tr>
		<tr>
			<th>내용</th>
			<td class="content">
				<%=QnA.getContent().replace("\n", "<br>") %>
			</td>
		</tr>
	</table>
	
	<div id="QnA_menu">
	<% if(loginUser!=null && (loginUser.getId().equals(QnA.getId()) || loginUser.getStatus()==9)) { %>
		<button type="button" id="removeBtn">글삭제</button>
		<button type="button" id="modifyBtn">글변경</button>
	<% } %>
	<% if(loginUser!=null) {//로그인 상태인 경우 %>	
		<button type="button" id="replyBtn">답글쓰기</button>
	<% } %>	
		<button type="button" id="listBtn">게시글목록</button>
	</div>
</div>

<form id="QnAForm" method="post">
	<input type="hidden" name="num" value="<%=num%>">
	<input type="hidden" name="pageNum" value="<%=pageNum%>">
</form>

<script type="text/javascript">
$("#removeBtn").click(function() {
	if(confirm("정말로 삭제 하시겠습니까?")) {
		$("#QnAForm").attr("action", "<%=request.getContextPath()%>/board/QnA/QnA_remove_action.jsp");
		$("#QnAForm").submit();
	}
});

$("#modifyBtn").click(function() {
	$("#QnAForm").attr("action", "<%=request.getContextPath()%>/index.jsp?workgroup=board/QnA&work=QnA_modify");
	$("#QnAForm").submit();
});

$("#listBtn").click(function() {
	$("#QnAForm").attr("action", "<%=request.getContextPath()%>/index.jsp?workgroup=board/QnA&work=QnA_list");
	$("#QnAForm").submit();
});
</script>








