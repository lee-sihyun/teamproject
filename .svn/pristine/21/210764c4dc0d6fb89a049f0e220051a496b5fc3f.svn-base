package site.itwill.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import site.itwill.dto.ProductDTO;

public class ProductDAO extends JdbcDAO {

	private static ProductDAO _dao;

	public ProductDAO() {
		// TODO Auto-generated constructor stub
	}

	static {

		_dao = new ProductDAO();
	}

	public static ProductDAO getDAO() {

		return _dao;

	}

	// ��ǰ������ �޾� PRODUCT ���̺� �����ϰ� �������� ������ ��ȯ�ϴ� �޼ҵ�-(�߰�)
	public int insertProduct(ProductDTO product) {

		Connection con = null;
		PreparedStatement pstmt = null;
		int rows = 0;

		try {
			con = getConnection();
			String sql = "insert into prodct values(?,?,?,?,?,?)";
			pstmt = con.prepareStatement(sql);
			pstmt.setInt(1, product.getNo());
			pstmt.setString(2, product.getName());
			pstmt.setInt(3, product.getPrice());
			pstmt.setInt(4, product.getStock());
			pstmt.setString(5, product.getImage());
			pstmt.setString(6, product.getImagedetail());

			rows = pstmt.executeUpdate();

		} catch (SQLException e) {
			System.out.println("[����]insertProduct() �޼ҵ� SQL ����= " + e.getMessage());
		} finally {
			close(con, pstmt);
		}
		return rows;
	}

	// ��ǰ���� ���޹޾� PRODUCT ���̺� �������� �˻��Ͽ� ��ȯ���� �ν��Ͻ� -(�˻�) 

	public ProductDTO getProduct(String name) {

		Connection con = null;
		PreparedStatement pstmt = null;
		ResultSet rs = null;
		ProductDTO product = null;

		try {

			con = getConnection();
			String sql = "select * from product where name=?";
			pstmt = con.prepareStatement(sql);

			pstmt.setString(1, name);

			rs = pstmt.executeQuery();

			if (rs.next()) {
				product = new ProductDTO();
				product.setNo(rs.getInt("no"));
				product.setName(rs.getString("name"));
				product.setPrice(rs.getInt("price"));
				product.setStock(rs.getInt("stock"));
				product.setImage(rs.getString("image"));
				product.setImagedetail(rs.getString("imagedetail"));
			}

		} catch (SQLException e) {
			System.out.println("[����]getProduct()�޼ҵ� SQL ����=" + e.getMessage());
		} finally {
			close(con, pstmt, rs);

		}
		return product;

	}

	// PRODUCT ���̺��� ��� �������� �˻��Ͽ� ��ȯ�ϴ� �޼ҵ�- (��ü �˻�)

	public List<ProductDTO> getProductList() {

		Connection con = null;
		PreparedStatement pstmt = null;
		ResultSet rs = null;
		List<ProductDTO> productList = new ArrayList<ProductDTO>();

		try {

			con = getConnection();
			String sql = "select * from product order by no";
			pstmt = con.prepareStatement(sql);
			rs = pstmt.executeQuery();

			while (rs.next()) {
				ProductDTO product = new ProductDTO();

				product.setNo(rs.getInt("no"));
				product.setName(rs.getString("name"));
				product.setPrice(rs.getInt("price"));
				product.setStock(rs.getInt("stock"));
				product.setImage(rs.getString("image"));
				product.setImagedetail(rs.getString("imagedetail"));

			}

		} catch (SQLException e) {

		} finally {
			close(con, pstmt, rs);
		}
		return productList;
	}

	// ��ǰ������ ���޹޾� PPODUCT ���̺��� �������� �����ϰ� ��ȯ - ����

	public int modifyProduct(ProductDTO product) {
		Connection con = null;
		PreparedStatement pstmt = null;
		int rows = 0;

		try {
			con = getConnection();

			String sql = "update product set no=?, name=?,price=?,stock=?,image=?,imagedetial=?";
			pstmt = con.prepareStatement(sql);

			pstmt.setInt(1, product.getNo());
			pstmt.setString(2, product.getName());
			pstmt.setInt(3, product.getPrice());
			pstmt.setInt(4, product.getStock());
			pstmt.setString(5, product.getImage());
			pstmt.setString(6, product.getImagedetail());

			rows = pstmt.executeUpdate();

		} catch (SQLException e) {
			System.out.println("[����]modifyProduct()�޼ҵ� SQL ���� =" + e.getMessage());
		} finally {
			close(con, pstmt);
		}
		return rows;

	}
//�̸��� ���޹޾� PRODUCT ���̺� �������� �����ϰ� �������� ������ ��ȯ�ϴ� �޼ҵ� -����
	public int removeProduct(String name) {

		Connection con = null;
		PreparedStatement pstmt = null;
		int rows = 0;

		try {

			con = getConnection();
			String sql = "delete from product where name=?";

			pstmt = con.prepareCall(sql);

			pstmt.setString(1, name);

			rows = pstmt.executeUpdate();

		} catch (SQLException e) {
			System.out.println("[����]removeProduct()�޼ҵ� sql ����=" + e.getMessage());
		} finally {
			close(con, pstmt);
		}
		return rows;
	}



}
