
<%@page import="java.text.SimpleDateFormat"%>
<%@page import="java.util.Date"%>
<%@page import="site.itwill.dto.testDTO"%>
<%@page import="site.itwill.dao.testDAO"%>
<%@page import="java.util.List"%>
<%@page import="site.itwill.dto.ProductDTO"%>

<%@page import="site.itwill.dao.ProductDAO"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>

<%
	String search = request.getParameter("search");
	if (search == null)
		search = "";
	String keyword = request.getParameter("keyword");
	if (keyword == null)
		keyword = "";

	int pageNum = 1;
	if (request.getParameter("pageNum") != null) {
		pageNum = Integer.parseInt(request.getParameter("pageNum"));

	}

	int pageSize = 10;

	int totalProduct = ProductDAO.getDAO().getProductTotal(search, keyword);

	int totalPage = (int) Math.ceil((double) totalProduct / pageSize);

	if (pageNum <= 0 || pageNum > totalPage) {
		pageNum = 1;
	}

	int startRow = (pageNum - 1) * pageSize + 1;

	int endRow = pageNum * pageSize;

	if (endRow > totalProduct) {
		endRow = totalProduct;
	}

	List<ProductDTO> productList = ProductDAO.getDAO().getProductList(startRow, endRow, search, keyword);

	int number = totalProduct - (pageNum - 1) * pageSize;

	//	noticeDTO loginMember=(MemberDTO)session.getAttribute("loginMember");
	//String currentDate = new SimpleDateFormat("yyyy-MM-dd").format(new Date());
%>
<jsp:include page="/admin/header.jsp" />
<link href="css/product_list.css" rel="stylesheet" type="text/css">

<!--본문내용역역 시작 content로 잡으면 됩니다  -->

<div id="content">
	<div class="mTitle">
		<h1>상품관리</h1>
	</div>
	<%-->
				 --%>
	<!--<div class="optionArea" id="QA_list1">
					

					</div> -->
	<!-- QA_list1종료 -->
	<div class="section" id="QA_list2">


		<div class="mOption">
			<table>
				<tr>

					<th scope="row">상품명</th>

					<td colspan="1">
						<div id="testfiled">

							<input type="text" class="fTexteSearchText">
						</div>

					</td>
				</tr>





			</table>

		</div>

		<!-- 검색영역 종료 -->
		<div class="mButtongCenter">
			<a href="#none" class="btnSearch"> <span>검색</span>

			</a> <a href="#none" class="btnSearchreset" id="eSearchFormInit"> <span>초기화</span>

			</a>



		</div>

		<!-- 표영역 -->

		<div class="mBoardtypeListgScrollgCell">

			<table class="eChkColor">


				<tr>

					<td><input type="checkbox" name="allCheck" id="allCheck"></td>
					<td class="type">번호</td>
					<td class="type">카테고리</td>
					<td class="type">상품코드</td>
					<td class="type">상품명</td>
					<td class="type">상품가격</td>
					<td class="type">상품재고수량</td>
					<td class="type">상품이미지</td>
					<%-- <td class="type"> 상품설명</td>--%>


				</tr>



				<%
					if (totalProduct == 0) {
				%>
				<tr>
					<td>등록된 상품이 존재하지 않습니다.</td>
				</tr>
				<%
					} else {
				%>
				<%
					for (ProductDTO product : productList) {
				%>
				<tr>
				
				
					<td>
					<input type="checkbox" name="checkNum" value="<%=product.getNum()%>" class="check">
					</td>
					<td><%=number%></td>

					<td>
						<%
							if (Integer.parseInt(product.getMainCategory()) == 1) {
						%> 배쓰 <%
							} else if (Integer.parseInt(product.getMainCategory()) == 2) {
						%>
						샤워 <%
							} else if (Integer.parseInt(product.getMainCategory()) == 3) {
						%>
						보디 <%
							}
						%>
					</td>


					<td><a
						href="<%=request.getContextPath()%>
							/admin/index.jsp?workgroup=product&work=product_detail&num=
							<%=product.getNum()%>&pageNum=<%=pageNum%>&search=<%=search%>&keyword=
							<%=keyword%>"><%=product.getItemNo()%></a></td>



					<td><%=product.getName()%></td>
					<td><%=product.getPrice()%></td>
					<td><%=product.getStock()%></td>
					<td><img
						src="<%=request.getContextPath()%>/admin/product_image/<%=product.getImage()%>"
						width="200"></td>
					<%-- 	<td> <%=product.getImageDetail() %></td>--%>
				</tr>
				<%
					number--;
				%>
				<%
					}
				%>
				<%
					}
				%>


			</table>
			<%
				int blockSize = 5;

				int startPage = (pageNum - 1) / blockSize * blockSize + 1;

				int endPage = startPage + blockSize - 1;

				if (endPage > totalPage) {
					endPage = totalPage;
				}
			%>

			<%-- 페이지 번호 출력 및 하이퍼 링크 --%>
			<div>
				<%
					if (startPage > blockSize) {
				%>
				<a
					href="<%=request.getContextPath()%>/admin/index.jsp?workgroup=product&work=product_list&pageNum=1&search=<%=search%>&keyword=<%=keyword%>">[처음]</a>
				<a
					href="<%=request.getContextPath()%>/admin/index.jsp?workgroup=product&work=product_list&pageNum=<%=startPage - blockSize%>&search=<%=search%>&keyword=<%=keyword%>">[이전]</a>
				<%
					} else {
				%>
				[처음][이전]
				<%
					}
				%>

				<%
					for (int i = startPage; i <= endPage; i++) {
				%>
				<%
					if (pageNum != i) {
				%>
				<a
					href="<%=request.getContextPath()%>/admin/index.jsp?workgroup=product&work=product_list&pageNum=<%=i%>&search=<%=search%>&keyword=<%=keyword%>">[<%=i%>]
				</a>
				<%
					} else {
				%>
				<span style="font-weight: bold; color: red;">[<%=i%>]
				</span>
				<%
					}
				%>
				<%
					}
				%>

				<%
					if (endPage != totalPage) {
				%>
				<a
					href="<%=request.getContextPath()%>/index.jsp?workgroup=board&work=board_list&pageNum=<%=startPage + blockSize%>&search=<%=search%>&keyword=<%=keyword%>">[다음]</a>
				<a
					href="<%=request.getContextPath()%>/index.jsp?workgroup=board&work=board_list&pageNum=<%=totalPage%>&search=<%=search%>&keyword=<%=keyword%>">[마지막]</a>
				<%
					} else {
				%>
				[다음][마지막]
				<%
					}
				%>
			</div>
			<br>

			<%-- 게시글 검색 --%>
			<form
				action="<%=request.getContextPath()%>/admin/index.jsp?workgroup=product&work=product_list"
				method="post" id="searchForm">
				<select name="search">
					<option value="name" selected="selected">&nbsp;상품명&nbsp;</option>
					<!-- <option value="itemNo">&nbsp;상품코드&nbsp;</option> -->

				</select> <input type="text" name="keyword" id="keyword">
				<button type="submit">검색</button>
			</form>
		</div>
	</div>
<form action="" method="post" name="productform" id="productform">
	<div class="mCtrltypeFooter">
		<div class="gLeft">
			<span class="txtLess">선택상품을 </span>

			<button type="button" class="btnNormaldelete" id="removeBtn">삭제</button>
			<button type="button" class="btnNormalmodify" id="modifyBtn">수정</button>




		</div>


	</div>


</form>
</div>




</div>
<!--content 영역종료 -->


</div>
<!-- container 영역종료 -->
</div>
<!-- wrap영역종료 -->

</body>
</html>
<script type="text/javascript">


$("#allCheck").change(function() {
	if($(this).is(":checked")) {
		$(".check").prop("checked",true);
	} else {
		$(".check").prop("checked",false);
	}	
});
		

$("#removeBtn").click(function() {
	if(confirm("삭제 하시겠습니까?")) {
		$("#productform").attr("action", "<%=request.getContextPath()%>/admin/product/product_check_remove_action.jsp?");
		$("#productform").submit();
	}
});

$("#modifyBtn").click(function() {
	$("#boardForm").attr("action", "<%=request.getContextPath()%>/admin/index.jsp?workgroup=product&work=product_modify");
						$("#boardForm").submit();
					});
	



</script>



			
					

