
<%@page import="site.itwill.dao.noticeDAO"%>
<%@page import="site.itwill.dto.noticeDTO"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%-- 게시글 번호를 전달받아 BOARD 테이블에 저장된 게시글을 검색하여 응답하는 JSP 문서 --%>
<%-- => BOARD 테이블에 저장된 게시글의 조회수를 1 증가 되도록 변경 --%>
<%-- => [글삭제]를 클릭한 경우 게시글 삭제 처리페이지(board_remove_action.jsp)로 이동 --%>
<%-- => [글변경]을 클릭한 경우 게시글 변경 입력페이지(board_modify.jsp)로 이동 --%>
<%-- => [답글쓰기]를 클릭한 경우 게시글 입력페이지(board_write.jsp)로 이동 --%>
<%-- => [게시글목록]을 클릭한 경우 게시글 목록 출력페이지(board_list.jsp)로 이동 --%>
<%
	//비정상적인 요청에 대한 응답 처리
	// => 전달값이 존재하지 않을 경우	
	if(request.getParameter("num")==null) {
		out.println("<script>");
		out.println("location.href='"+request.getContextPath()+"/admin/index.jsp?workgroup=board&work=board_list';");
		out.println("</script>");
		return;
	}
	
	//전달값을 반환받아 저장
	int num=Integer.parseInt(request.getParameter("num"));
	String pageNum=request.getParameter("pageNum");
	String search=request.getParameter("search");
	String keyword=request.getParameter("keyword");

	//게시글 번호를 전달하여 BOARD 테이블에 저장된 게시글을 검색하여 반환하는 DAO 클래스의 메소드 호출
	noticeDTO notice=noticeDAO.getDAO().getNotice(num);
	
	//비정상적인 요청에 대한 응답 처리
	// => 검색된 게시글이 없거나 삭제된 게시글인 경우
	if(notice==null) {
		out.println("<script>");
		out.println("location.href='"+request.getContextPath()+"/admin/index.jsp?workgroup=board&work=board_list';");
		out.println("</script>");
		return;
	}

	//세션으로 공유된 인증정보를 반환받아 저장
	//MemberDTO loginMember=(MemberDTO)session.getAttribute("loginMember");
	


	
	//게시글 번호를 전달하여 BOARD 테이블에 저장된 게시글의 조회수를 1 증가 되도록 변경하는 DAO 클래스의 메소드 호출
	noticeDAO.getDAO().modifyReadCount(num);
%>    
<style type="text/css">
#wrapper {
	width: 500px;
	margin: 0 auto;
}

table {
	border: 1px solid black;
	border-collapse: collapse; 
}

th, td {
	border: 1px solid black;
	padding: 5px;
}

th { width: 100px; }

td { width: 400px; }

.title, .content { text-align: left; }

.content {
	height: 100px;
	vertical-align: middle;
}

#board_menu {
	text-align: right;
	margin: 5px;
}
</style>

<div id="wrapper">
	<h2>게시글</h2>
	<table>
		<tr>
			<th>작성자</th>
			<td>
				<%=notice.getId() %>
				<%-- 로그인 사용자가 관리자인 경우 --%>
				<%-- <% if(loginMember!=null && loginMember.getStatus()==9) { %>
				[<%=board.getIp() %>]
				<% } %>--%>
				
			</td>
		</tr>
		<tr>
			<th>작성일</th>
			<td><%=notice.getRegdate().substring(0, 19) %></td>
		</tr>
		<tr>
			<th>조회수</th>
			<td><%=notice.getReadcount()+1 %></td>
		</tr>
		<tr>
			<th>제목</th>
			<td class="title">
				<%--<% if(botice.getStatus()==1) { [비밀글]<% } %> --%>
				<%=notice.getTitle() %>
			</td>
		</tr>
		
		<tr>
			<th>내용</th>
			<td class="content">
				<%=notice.getContent().replace("\n", "<br>") %>
			</td>
		</tr>
	</table>
	
	<div id="board_menu">
	<%-- 로그인 사용자가 작성자이거나 관리자인 경우 
	<% if(loginMember!=null && (loginMember.getId().equals(board.getId()) || loginMember.getStatus()==9)) { %>
		<button type="button" id="removeBtn">글삭제</button>
		<button type="button" id="modifyBtn">글변경</button>
	<% } %>
	<% if(loginMember!=null) {//로그인 상태인 경우 %>	
		<button type="button" id="replyBtn">답글쓰기</button>
	<% } %>	
		<button type="button" id="listBtn">게시글목록</button>
	</div>--%>
</div>

<form id="boardForm" method="post">
	<input type="hidden" name="num" value="<%=num%>">
	<input type="hidden" name="pageNum" value="<%=pageNum%>">
	<input type="hidden" name="search" value="<%=search%>">
	<input type="hidden" name="keyword" value="<%=keyword%>">
</form>
<%-- 
<script type="text/javascript">
$("#removeBtn").click(function() {
	if(confirm("정말로 삭제 하시겠습니까?")) {
		$("#boardForm").attr("action", "<%=request.getContextPath()%>/site/board/board_remove_action.jsp");
		$("#boardForm").submit();
	}
});

$("#modifyBtn").click(function() {
	$("#boardForm").attr("action", "<%=request.getContextPath()%>/site/index.jsp?workgroup=board&work=board_modify");
	$("#boardForm").submit();
});

$("#replyBtn").click(function() {
	$("#boardForm").attr("action", "<%=request.getContextPath()%>/site/index.jsp?workgroup=board&work=board_write&ref=<%=board.getRef()%>&reStep=<%=board.getReStep()%>&reLevel=<%=board.getReLevel()%>");
	$("#boardForm").submit();
});

$("#listBtn").click(function() {
	$("#boardForm").attr("action", "<%=request.getContextPath()%>/site/index.jsp?workgroup=board&work=board_list");
	$("#boardForm").submit();
});
</script>
--%>







