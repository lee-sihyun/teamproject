<%@page import="java.util.Date"%>
<%@page import="java.text.SimpleDateFormat"%>
<%@page import="site.itwill.dto.ReviewDTO"%>
<%@page import="site.itwill.dao.ProductDAO"%>
<%@page import="site.itwill.dto.ProductDTO"%>
<%@page import="java.util.List"%>
<%@page import="site.itwill.dao.ReviewDAO"%>
<%@page import="site.itwill.dto.LushUserDTO"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%
	//POST 방식으로 요청되어 전달된 값들에 대한 캐릭터셋 변경
	request.setCharacterEncoding("UTF-8");

	LushUserDTO loginUser1=(LushUserDTO)session.getAttribute("loginUser");

	int item = ProductDAO.getDAO().getItemNo();
	
	//전달된 페이지번호를 반환받아 저장
	int pageNum = 1;//페이지번호를 저장하기 위한 변수
	if (request.getParameter("pageNum") != null) {//전달값이 존재할 경우
		pageNum = Integer.parseInt(request.getParameter("pageNum"));
	}

	//페이지에 응답될 게시글의 갯수 설정
	int pageSize = 10;//응답 게시글의 갯수를 저장하기 위한 변수

	//상품번호에 저장된 전체 게시글의 갯수를 반환하는 DAO 클래스의 메소드 호출
	int totalReview = ReviewDAO.getDAO().getReviewTotal(item);

	//총 페이지 갯수를 계산하여 저장
	int totalPage = (int) Math.ceil((double) totalReview / pageSize);

	//전달받은 페이지 번호에 대한 유효성 검사
	if (pageNum <= 0 || pageNum > totalPage) {
		//비정상적인 페이지 번호가 전달된 경우 무조건 1 페이지로 설정 
		pageNum = 1;
	}
	//페이지 번호에 대한 게시글 시작 행번호를 계산하여 저장
	// => 1 Page : 1, 2 Page : 11, 3 Page : 21, 4 Page : 31,... 
	int startRow = (pageNum - 1) * pageSize + 1;

	//페이지 번호에 대한 게시글 종료 행번호를 계산하여 저장
	// => 1 Page : 10, 2 Page : 20, 3 Page : 30, 4 Page : 41,... 
	int endRow = pageNum * pageSize;

	//마지막 페이지의 게시글 종료 행번호를 게시글 전체 갯수로 변경
	if (endRow > totalReview) {
		endRow = totalReview;
		
	//시작 행번호와 종료 행번호를 전달하여 Review 테이블에서 페이지에 
	//응답될 게시글 목록을 검색하여 반환하는 DAO 클래스의 메소드 호출
	List<ReviewDTO> ReviewList=ReviewDAO.getDAO().getReviewList(startRow, endRow, item);
	}
	//페이지에 응답될 게시글의 출력시작번호를 계산하여 저장
	// => 게시글이 하나 출력될 때마다 1씩 감소
	int number=totalReview-(pageNum-1)*pageSize;
	                  	
	//서버의 현재 날짜(시간)정보 저장
	String currentDate=new SimpleDateFormat("yyyy-MM-dd").format(new Date());
	
%>	

<title>Insert title here</title>

<link href="https://fonts.googleapis.com/css?family=Noto+Sans+KR&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Anton|Archivo+Black&display=swap" rel="stylesheet">

<style type="text/css">
.reviewList {
width: 100%
}

.title-container {
	border-bottom: #dbdbdb 2px solid;
    padding-bottom: 0px;
    margin-top: 30px;
    width: 100%;
}


</style>
</head>
<div class="reviewlist">
	<div class="title-container"></div>
	<div class="review-list">
		<div class="article review-row" data-sno>
			<div class="summary">
				<div class = "star">
					<%=Review.getRating()%>
				</div>
				<div class = "date">
					<% if(currentDate.equals(Review.getRegDate().substring(0,10))) { %> 
					<%=Review.getRegDate().substring(11, 19) %> 
					<% } else { %> <%=Review.getRegDate().substring(0, 19) %> <% } %>
				</div>
				<div class = "name"><%=Review.getId() %></div>
			</div>
			<div class="contents-container">
				<div class="info"></div>
				<div class="text-container"><%=Review.getContent() %></div>
			</div>
		</div>
	</div>
</div>