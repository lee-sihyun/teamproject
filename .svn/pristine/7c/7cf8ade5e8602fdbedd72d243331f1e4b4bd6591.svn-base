<%@page import="site.itwill.dto.pageDTO"%>
<%@page import="site.itwill.dao.pageDAO"%>
<%@page import="site.itwill.dto.OrderDTO"%>
<%@page import="site.itwill.dao.OrderDAO"%>
<%@page import="java.util.List"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>

<%
	List<OrderDTO> orderList4 = OrderDAO.getOrderDAO().getRefund();
	List<OrderDTO> orderList5 = OrderDAO.getOrderDAO().getExchange();
	
	
	
	String search = request.getParameter("search");
	if (search == null)
		search = "";
	String keyword = request.getParameter("keyword");
	if (keyword == null)
		keyword = "";

	int pageNum = 1;
	if (request.getParameter("pageNum") != null) {
		pageNum = Integer.parseInt(request.getParameter("pageNum"));

	}

	int pageSize = 10;

	int totalExchange = pageDAO.getDAO().getExchangeotal(search, keyword);
	int totalPage = (int) Math.ceil((double) totalExchange / pageSize);

	if (pageNum <= 0 || pageNum > totalPage) {
		pageNum = 1;
	}

	int startRow = (pageNum - 1) * pageSize + 1;

	int endRow = pageNum * pageSize;

	if (endRow > totalExchange) {
		endRow = totalExchange;
	}

	List<pageDTO> pageList5 = pageDAO.getDAO().getExchangeList(startRow, endRow, search, keyword);

	int number = totalExchange - (pageNum - 1) * pageSize;
	
	
%>



<jsp:include page="/admin/header.jsp" />
<link href="css/admin_refund.css" rel="stylesheet" type="text/css">

<div id="content">

	<form method="post" name="exchangeform" id="exchangeform">

		<div class="headingArea">
			<div class="mTitle">
				<h1>환불 및 교환</h1>
			</div>


		</div>

		<div class="mTabtypeOrderdelivery">

			<ol class="tab" style="margin-bottom: 0px; margin-top: 0px;">
				<li id="ship_tab_no_pay_cnt"><a
					href="<%=request.getContextPath()%>/admin/index.jsp?workgroup=order&work=refund"
					id="no_pay_cnt" style="width: 206px;"><span
						class="thumb deposit"><strong class="title">환불</strong><span
							class="count" id="no_pay_cnt_value"><%=orderList4.size()%></span></span></a></li>




				<li id="ship_tab_is_shipped_f"><a
					href="<%=request.getContextPath()%>/admin/index.jsp?workgroup=order&work=exchange"
					id="is_shipped_f" style="width: 206px;"><span
						class="thumb ready"><strong class="title">교환</strong><span
							class="count" id="is_shipped_f_value"><%=orderList5.size()%></span></span></a></li>
				<!-- <li id="ship_tab_is_shipped_w"><a
								href="admin_delivery3.html" id="is_shipped_w"
								style="width: 206px;"><span class="thumb delivery"><strong
										class="title">배송중</strong><span class="count"
										id="is_shipped_m_value">0</span></span></a></li>

							<li id="ship_tab_is_shipped_m"><a
								href="admin_delivery4.html" id="is_shipped_m"
								style="width: 206px;"><span class="thumb delivery"><strong
										class="title">배송완료</strong><span class="count"
										id="is_shipped_m_value">0</span></span></a></li> -->



			</ol>
		</div>
		<!-- 상단탭완료 -->






		<div class="section" id="QA_deposit2"
			style="margin-left: -50; height: 800px;">

			<div class="mTitle" style="display: none;"></div>

			<div class="mTab typeTab eTab"></div>
			<div id="tabNumber" class="tabCont" style="display: block;">


				<div class="mCtrltypeHeadersetting" style="width: 250px;">
					<div class="test">
						<table>
							<tr>

								<th scope="row">상품명</th>

								<td colspan="1">
									<div id="testfiled">

										<input type="text" class="fText sBaseSearchBox">
									</div>

								</td>
							</tr>





						</table>



					</div>

					<div class="gLeft">

						<button type="submit" id="exchange" class="btnCtrl">교환처리</button>


					</div>

				</div>
				<div class="mBoardtypeOrdergScrollgCellSingle"
					style="height: 550px; margin-top: 200px;">

					<table id="searchResultList" border="1" class="eChkTr"
						style="height: 500px;">

						<tr>


							<th scope="col" style="width: 30px;" id="check"><input
								type="checkbox" name="allCheck" id="allCheck"></th>


							<th scope="col" style="width: 80px;">주문번호</th>
							<th scope="col" style="widht: 50px;">상품명</th>
							<th scope="col" style="widht: 50px;">주문일자</th>
							<th scope="col" style="widht: 50px;">상태정보</th>

						</tr>



						<%
							for (pageDTO order : pageList5) {
						%>

						<tr>

							<td><input type="checkbox" name="checkNo" id="checkNo"
								value="<%=order.getOrderNo()%>" class="check"></td>
							<td><%=order.getOrderNo()%></td>
							<td><%=order.getName()%></td>
							<td><%=order.getOrderDate().substring(0, 19)%></td>
							<td>
								<%if(order.getOrderStatus() == 4) { %> 
								 교환요청
								 <% }else if (order.getOrderStatus() == 5) {%>
								교환완료 
								<%} %>
							</td>
						</tr>

						<%
							}
						%>
					</table>
					
					
						
			<%
					int blockSize = 5;

					int startPage = (pageNum - 1) / blockSize * blockSize + 1;

					int endPage = startPage + blockSize - 1;

					if (endPage > totalPage) {
						endPage = totalPage;
					}
				%>


					<%
						if (startPage > blockSize) {
					%>
					<a
						href="<%=request.getContextPath()%>/admin/index.jsp?workgroup=order&work=exchange&pageNum=1&search=<%=search%>&keyword=<%=keyword%>">[처음]</a>
					<a
						href="<%=request.getContextPath()%>/admin/index.jsp?workgroup=order&work=exchange&pageNum=<%=startPage - blockSize%>&search=<%=search%>&keyword=<%=keyword%>">[이전]</a>
					<%
						} else {
					%>
					[처음][이전]
					<%
						}
					%>

					<%
						for (int i = startPage; i <= endPage; i++) {
					%>
					<%
						if (pageNum != i) {
					%>
					<a
						href="<%=request.getContextPath()%>/admin/index.jsp?workgroup=order&work=exchange&pageNum=<%=i%>&search=<%=search%>&keyword=<%=keyword%>">[<%=i%>]
					</a>
					<%
						} else {
					%>
					<span style="font-weight: bold; color: red;">[<%=i%>]
					</span>
					<%
						}
					%>
					<%
						}
					%>

					<%
						if (endPage != totalPage) {
					%>
					<a
						href="<%=request.getContextPath()%>/index.jsp?workgroup=order&work=exchange&pageNum=<%=startPage + blockSize%>&search=<%=search%>&keyword=<%=keyword%>">[다음]</a>
					<a
						href="<%=request.getContextPath()%>/index.jsp?workgroup=order&work=exchange&pageNum=<%=totalPage%>&search=<%=search%>&keyword=<%=keyword%>">[마지막]</a>
					<%
						} else {
					%>
					[다음][마지막]
					<%
						}
					%>
				</div>


			</div>



		</div>

	</form>
</div>
<!--content 영역종료 -->


</div>
<!-- container 영역종료 -->
</div>
<!-- wrap영역종료 -->

</body>
</html>

<script type="text/javascript">
$("#allCheck").change(function() {
   if($(this).is(":checked")) {
      $(".check").prop("checked",true);
   } else {
      $(".check").prop("checked",false);
   }   
});

$("#exchange").click(function () {
	
	$("#exchangeform").attr("action","<%=request.getContextPath()%>/admin/order/exchange_action.jsp");
	$("#exchangeform").submit();
	
	
});


</script>