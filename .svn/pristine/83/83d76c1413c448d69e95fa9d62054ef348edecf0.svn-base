<%@page import="java.util.Date"%>
<%@page import="site.itwill.dto.QnADTO"%>
<%@page import="site.itwill.dto.LushUserDTO"%>
<%@page import="java.text.SimpleDateFormat"%>
<%@page import="java.util.List"%>
<%@page import="site.itwill.dao.QnADAO"%>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>


<%
	//POST 방식으로 요청되어 전달된 값들에 대한 캐릭터셋 변경
	request.setCharacterEncoding("UTF-8");

	LushUserDTO loginUser1=(LushUserDTO)session.getAttribute("loginUser");
	//List<CartDTO> cartList=CartDAO.getCartDAO().getCartList(loginUser1.getId());

	//전달된 페이지번호를 반환받아 저장
	int pageNum = 1;//페이지번호를 저장하기 위한 변수
	if (request.getParameter("pageNum") != null) {//전달값이 존재할 경우
		pageNum = Integer.parseInt(request.getParameter("pageNum"));
	}

	//페이지에 응답될 게시글의 갯수 설정
	int pageSize = 10;//응답 게시글의 갯수를 저장하기 위한 변수

	//QnA 테이블에 저장된 전체 게시글의 갯수를 반환하는 DAO 클래스의 메소드 호출
	int totalQnA = QnADAO.getDAO().getQnATotal(loginUser1.getId());//전체 게시글의 갯수를 저장하기 위한 변수

	//총 페이지 갯수를 계산하여 저장
	int totalPage = (int) Math.ceil((double) totalQnA / pageSize);

	//전달받은 페이지 번호에 대한 유효성 검사
	if (pageNum <= 0 || pageNum > totalPage) {
		//비정상적인 페이지 번호가 전달된 경우 무조건 1 페이지로 설정 
		pageNum = 1;
	}
	//페이지 번호에 대한 게시글 시작 행번호를 계산하여 저장
	// => 1 Page : 1, 2 Page : 11, 3 Page : 21, 4 Page : 31,... 
	int startRow = (pageNum - 1) * pageSize + 1;

	//페이지 번호에 대한 게시글 종료 행번호를 계산하여 저장
	// => 1 Page : 10, 2 Page : 20, 3 Page : 30, 4 Page : 41,... 
	int endRow = pageNum * pageSize;

	//마지막 페이지의 게시글 종료 행번호를 게시글 전체 갯수로 변경
	if (endRow > totalQnA) {
		endRow = totalQnA;
	}
	
	//아이디값 세션 설정
	//session.setAttribute("id", "value");
	//세션속성 사용
	//String id = (String)session.getAttribute("id");
	
	
	// 유저 로그인 했을 때 그 사람만의 글을 보여주도록 ID를 찾아 반환하는
	// DAO 클래스의 메소드 호출
	//List<QnADTO> QnAIDList=QnADAO.getDAO().getQnAIDList(loginUser1.getId());
	
	//시작 행번호와 종료 행번호를 전달하여 QnA 테이블에서 페이지에 
	//응답될 게시글 목록을 검색하여 반환하는 DAO 클래스의 메소드 호출
	List<QnADTO> QnAList=QnADAO.getDAO().getQnAList(startRow, endRow, loginUser1.getId());
	
	//페이지에 응답될 게시글의 출력시작번호를 계산하여 저장
	// => 게시글이 하나 출력될 때마다 1씩 감소
	int number=totalQnA-(pageNum-1)*pageSize;
	                    
	//세션으로 공유된 인증정보(회원정보)를 반환받아 저장
	//LushUserDTO loginUser=(LushUserDTO)session.getAttribute("loginUser");
	
	//서버의 현재 날짜(시간)정보 저장
	String currentDate=new SimpleDateFormat("yyyy-MM-dd").format(new Date());
%>
<!DOCTYPE html>
<html>
<head>

<!-- 달력 JQuery UI -->
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src="<%=request.getContextPath() %>/resources/gd_ui.js.다운로드"></script>


<title>Insert title here</title>


<style type="text/css">
#content {  
    width: 1500px;
    height: 1300px;

    margin: 0 auto;
}
#main {
	display: inline;
    width: 80%;
    float: left;
    margin: 0 0 200px 50px;
}
html {
	overflow-y: scroll;
}

html, body, form, #wrap {
	height: 100%;
}

#content {
	margin: 50px auto;
	padding: 0 0 50px;
}

.contents-inner {
	padding: 90px 0 100px !important;
}

body {
	animation: fadein 1.5s;
	-webkit-font-smoothing: antialiased;
}

body {
	color: #333;
	font-family: "notokrR";
	font-size: 14px;
	line-height: 1.4;
	letter-spacing: -0.5px;
}

* {
	margin: 0;
	padding: 0;
}

body {
	display: block;
}

.section {

	height: 282px important!;
}

.main .section-header {
	overflow: hidden;
	margin: 0;
	padding: 0 0 40px;
	line-height: 19.6px;
}

.section-header {
	position: relative;
}

.main .section-header h2 {
	float: left;
	font-size: 28px;
	color: #000;
	font-family: "notokrB";
}

h2 {
	display: block;
	margin-block-start: 0.83em;
	margin-block-end: 0.83em;
	margin-inline-start: 0px;
	margin-inline-end: 0px;
	font-weight: bold;
}

.option.type1 {
	margin: 0;
}

.option {
	float: right;
	position: static;
}

.option.type1 {
	top: auto;
	bottom: 0;
	right: 0;
}
.question {
	height: 80px;
}
.contactus-write {
	width: 120px;
	height: 80px;
	line-height: 50px;
	font-size: 14px;
	color: #000;
	background: #fff;
	border: 1px solid #000;
}

.skinbtn * {
	font-size: 100%;
}

address, caption, cite, code, dfn, em, var {
	font-style: normal;
}

input, select {
	outline: none;
	font-family: "notokrR";
	color: #717171;
}

.section-body {
	height: 202px;
}

.date-check {
	height: 40px;
	overflow: hidden;
	padding: 23px 10px 23px 28px;
	border: 1px solid #e8e8e8;
}

.date-check .h3 {
	margin: 7px 20px 0 0;
	font-family: "notokrM";
	font-weight: normal;
	color: #333;
}

.date-check .check-option, .date-check .check-cal, .date-check .submit-block,
	.date-check .h3 {
	float: left;
	vertical-align: middle;
}

.check-option {
	width: 320px;
}

.clear {
	zoom: 1;
}

.check-option-inner {
	overflow: hidden;
	padding-left: 1px;
}

.check-option-inner .btn {
	padding: 8px 10px;
	float: left;
}

.check-option-inner .btn .inner {
	width: 100%;
	color: #8f8f8f;
	font-size: 16px;
	line-height: 20px;
}

button {
	font-family: "notokrR";
}

button {
	cursor: pointer;
	background: none;
	border: none;
	outline: none;
}

* {
	margin: 0;
	padding: 0;
}

button {
	-webkit-appearance: button;
	-webkit-writing-mode: horizontal-tb !important;
	text-rendering: auto;
	letter-spacing: normal;
	word-spacing: normal;
	text-transform: none;
	text-indent: 0px;
	text-shadow: none;
	display: inline-block;
	text-align: center;
	align-items: flex-start;
	box-sizing: border-box;
	font: 400 13.3333px Arial;
}

.check-option+.check-cal {
	margin: 0 0 0 60px;
}

.check-cal .cal-from, .check-cal .cal-to {
	width: 152px;
}

.check-cal .cal-from, .check-cal .divide, .check-cal .cal-to {
	display: inline-block;
	position: relative;
}

.check-cal .cal-from input, .check-cal .cal-to input {
	width: 100%;
	height: 40px;
	line-height: 40px;
	border: 1px solid #ccc;
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	box-sizing: border-box;
	padding-left: 20px;
}

input, select {
	outline: none;
	font-family: "notokrR", Malgun Gothic,
		'' 맑은 고딕 ',Helvetica,AppleGothic,dotum,' 돋움 ', sans-serif;
	color: #717171;
}

* {
	margin: 0;
	padding: 0;
}

input {
	-webkit-writing-mode: horizontal-tb !important;
	text-rendering: auto;
	letter-spacing: normal;
	word-spacing: normal;
	text-transform: none;
	text-indent: 0px;
	text-shadow: none;
	display: inline-block;
	text-align: start;
	-webkit-appearance: textfield;
	background-color: white;
	-webkit-rtl-ordering: logical;
	cursor: text;
	font: 400 13.3333px Arial;
}

.check-cal .icon-cal {
	position: absolute;
	top: 9px;
	right: 15px;
}

img {
	border: none;
	vertical-align: top;
}

.check-cal .divide {
	padding: 0 5px;
}

.check-cal .cal-from, .check-cal .divide, .check-cal .cal-to {
	display: inline-block;
	position: relative;
}

.check-cal .cal-from, .check-cal .cal-to {
	width: 152px;
}

element.style {
	
}

.check-cal .cal-from input, .check-cal .cal-to input {
	width: 100%;
	height: 40px;
	line-height: 40px;
	border: 1px solid #ccc;
	box-sizing: border-box;
	padding-left: 20px;
}

.date-check .submit-block {
	margin: 0 0 0 25px;
}

.date-check .submit-block, .date-check .h3 {
	float: left;
	vertical-align: middle;
}

.date-check .submit-block .skinbtn.point2 {
	width: 110px;
	height: 40px;
	line-height: 38px;
	background: #000;
	color: #fff;
	font-weight: normal;
	font-size: 16px;
}

.date-check .submit-block .skinbtn.point2 img {
	display: none;
}

.skinbtn img {
	vertical-align: middle;
}

.qa_noti {
	line-height: 26px;
	color: #8f8f8f;
}

.mt10 {
	width: 980px;
	height: 104px;
	margin-top: 10px;
	text-align: left;
}

p {
	display: block;
	margin-block-start: 5px;
	margin-block-end: 5px;
	margin-inline-start: 0px;
	margin-inline-end: 0px;
}

.qa_noti em {
	color: #333;
	font-family: "notokrM";
}

.main .section-header .option a.skinbtn {
	text-decoration: none;
}

.skinbtn.base2.contactus-write {
	padding: 0 12px;
}

form {
	display: block;
}

.top-date {
	width: 980px;
	height: 147px;
	margin: 80px 0 0 100px;
}

.table1>table {
	border-top: 1px solid #000;
}

table, th, td {
	margin: 0;
	padding: 0;
	border-spacing: 0;
	border: 0;
	border-collapse: collapse;
	vertical-align: middle;
}

table {
	display: table;
}

colgroup {
	display: table-column-group;
}

col {
	display: table-column;
}

thead {
	display: table-header-group;
	vertical-align: middle;
	border-color: inherit;
}

tr {
	display: table-row;
	vertical-align: inherit;
	border-color: inherit;
}

.body-QnA .table1>table>thead>tr>th {
	font-size: 14px;
}

.table1>table>thead>tr>th {
	padding: 15px 0;
	border-bottom: 1px solid #e7e7e7;
	font-weight: normal;
	color: #8f8f8f;
}

table, th, td {
	margin: 0;
	border-spacing: 0;
	border: 0;
	border-collapse: collapse;
	vertical-align: middle;
}

tbody {
	display: table-row-group;
	vertical-align: middle;
	border-color: inherit;
}

.table1.type1 .goods-QnA td.no-data02, .table1>.QnA-list .no-data02 {
	height: 75px;
	text-align: center;
	color: #797979;
}

nav {
	height: 20px;
	display: block;
}

.paging{
	padding: 20px 0 0;
    text-align: center;
}

/* Column container */
#side1 {
	display: inline;
	width: 20%;
	float: left;
	height: 80%;
}

#side1 .side2 {
	padding: 0;
	width: 200px;
	margin: 0;
}

#side1 .lnb {
	width: 100%;
	margin: 0 auto;
	position: relative;
	z-index: 2;
}

.side4 {
    padding: 90px 0 100px;
}

#side1 .side4 h2 {
	font-size: 22px;
	font-family: "notokrB";
	font-weight: bold;
	line-height: 24px;
}

#side1 h2 {
	position: relative;
	margin: 0 auto 10px;
	text-align: left;
}

h2 {
	margin-block-start: 0.83em;
	margin-block-end: 0.83em;
	margin-inline-start: 0px;
	margin-inline-end: 0px;
}

#side1 .side4 h3 {
	position: relative;
	padding: 0 0 15px 0;
	line-height: 20px;
	font-size: 16px;
	font-weight: bold;
	font-family: "notokrM";
	letter-spacing: 1px;
	text-align: left;
	background: none;
}

.side4 h3 {
	margin: 32px 0 0;
	color: #222;
}

h3 {
	margin-block-start: 1em;
	margin-block-end: 1em;
	margin-inline-start: 0px;
	margin-inline-end: 0px;
}

#side1 .side4 ul {
	padding: 0 0 0 8px;
}

.mypageUser {
	margin-top: 50px;
	margin-bottom: 100px;
}

.lnb .side4 ul {
	line-height: 24px;
	text-align: center;
}

ul {
	margin-block-start: 1em;
	margin-block-end: 1em;
	margin-inline-start: 0px;
	margin-inline-end: 0px;
	padding-inline-start: 40px;
}

ul, li {
	margin: 0;
	list-style: none;
}

#side1 .side4 li {
	line-height: 28px;
}


ul, li {
	margin: 0 auto;
	padding: 0;
	list-style: none;
}

li {
	display: list-item;
}

#side1 .side4 li a {
	color: #8f8f8f;
}

a {
	text-decoration: none;
}

.content {
	width: 1200px;
	height: 1200px;
	margin: 0 auto;
}

.QnA-list {
	text-align: center;
}
.section-body {
	text-align: center;
}
</style>
</head>
<body>
<div id="content">
	<!-- sidebar -->
	<div id="side1">
		<div class="side2">
			<div class="side3">
				<div class="side4">
					<h2>마이페이지</h2>
					<h3>쇼핑정보</h3>
					<ul>
						<li><a
							href="javascript:location.href='<%=request.getContextPath() %>/index.jsp?workgroup=lushuser&work=order_search';">주문목록/배송조회</a></li>
						<li><a
							href="javascript:location.href='<%=request.getContextPath() %>/index.jsp?workgroup=lushuser&work=order_refund';">환불/반품/교환내역</a></li>
					</ul>
					<h3>고객센터</h3>
					<ul>
						<li><a
							href="javascript:location.href='<%=request.getContextPath() %>/index.jsp?workgroup=board/QnA&work=QnA_list';">1:1문의</a></li>
						<li><a
							href="javascript:location.href='<%=request.getContextPath() %>/index.jsp?workgroup=board/FAQ&work=FAQ_List';">FAQ</a></li>
					</ul>
					<h3>회원정보</h3>
					<ul>
						<li><a
							href="javascript:location.href='<%=request.getContextPath() %>/index.jsp?workgroup=lushuser&work=changeUser_confirm';">회원정보변경</a></li>
						<li><a
							href="javascript:location.href='<%=request.getContextPath() %>/index.jsp?workgroup=lushuser&work=deleteUser';">회원탈퇴</a></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
<%--본문 --%>
	<div class="main">
		<div class="section">
			<div class="section-header">
				<h2 class="h2">1:1문의</h2>
				<div class="option type1">
					<a class="skinbtn base2 contactus-write" id="question" href="<%=request.getContextPath()%>/board/QnA/QnA_write.jsp"><em>1:1 문의하기</em></a>
				</div>
			</div>
				<%-- 
				<form name="frmSearch" method="get" action="<%=request.getContextPath()%>/board/QnA/board_write_action.jsp">
					<input type="hidden" name="bdId" value="qa"> 
					<input type="hidden" name="memNo" value="425379"> 
					<input type="hidden" name="noheader" value="y">
					--%>
				<div class="section-body">
						<div class="date-check">
							<h3 class="h3">조회기간</h3>

							<div class="check-option clear">
								<div class="check-option-inner" data-target-name="rangDate[]">
									<div class="btn">
										<button class="inner" type="button" data-value="0">오늘</button>
									</div>
									<div class="btn">
										<button class="inner" type="button" data-value="7">7일</button>
									</div>
									<div class="btn">
										<button class="inner" type="button" data-value="15">15일</button>
									</div>
									<div class="btn">
										<button class="inner" type="button" data-value="30">1개월</button>
									</div>
									<div class="btn">
										<button class="inner" type="button" data-value="90">3개월</button>
									</div>
									<div class="btn">
										<button class="inner" type="button" data-value="365">1년</button>
									</div>
								</div>
							</div>
							<div class="check-cal">
								<div class="cal-from">
									<input type="date"  name="theday1" min="2010-01-01" max="2019-12-31">
							
								</div>
								<div class="divide">~</div>
								<div class="cal-to">
									<input type="date"  name="theday2" min="2010-01-01" max="2019-12-31">
								</div>
							</div>
							<div class="submit-block">
								<button class="skinbtn point2 qa-find" type="submit">
									<em>조회</em>
								</button>
							</div>
						</div>
						<hr>
						<div class="qa_noti mt10">
							<br>
							<p>LUSH에 궁금한 내용을 등록해 주세요. 담당자가 확인 후 빠르게 답변해 드리겠습니다.</p>
							<p>- 고객센터 운영일 : 월~금요일(토/일/공휴일 휴무) - 운영시간 : 10:00~17:00 - 점심시간 : 12:00~13:00</p>
							<p>- 문의 메일 : webmaster@lush.co.kr *메일 수신이 제대로 안되실 경우 고객 센터로 연락 주세요.</p>
							<p>
								<em>- 문의 전화 : TEL. 1644 - 2357 / FAX. 02 - 795 - 7516</em>
							</p>
						</div>
					</div>
				</form>
			</div>
			<div class="section top-date">
				<div class="section-body">
					<div class="table1 type1 m2" align="center">
						<table class="QnA-list" >
							<colgroup>
								<col style="width: 300px">
								<col style="width: 200px">
								<col style="width: 800px">
								<col style="width: 200px">
							</colgroup>
							<thead>
								<tr>
									<th>문의날짜</th>
									<th>카테고리</th>
									<th>제목</th>
									<th>문의상태</th>
								</tr>
							</thead>
							<tbody>
								<% if(totalQnA==0) { %>
								<tr>
									<td colspan="5" align="center" class="no-data02">게시글이 존재하지않습니다.</td>
								</tr>
								<% } else { %>
								<%-- 게시글 목록 출력 --%>
								<% for(QnADTO QnA:QnAList) { %>
								<tr>
									<%--문의 날짜--%>
									<td align="center" class="forstyling1">
										<% if(currentDate.equals(QnA.getRegDate().substring(0,10))) { %> 
										<%=QnA.getRegDate().substring(11, 19) %> 
										<% } else { %> <%=QnA.getRegDate().substring(0, 19) %> <% } %>
									</td>

									<%--카테고리--%>
									<td align="center" class="forstyling2"><%=QnA.getCategory() %></td>

									<%-- 제목 --%>
									<td align="center" class="title">
									
										<% if(QnA.getRefStep()!=0) {//답글인 경우%> 
										<%-- 왼쪽 여백은 답변 깊이에 따라 다르게 출력 --%> 
										<span style="margin-left: <%=QnA.getRefLevel()*20 %>px;">└[답글]</span> 
										<% } %> 
										
										<!-- 게시글 제목출력 및 하이퍼 링크  -->
										<% if(QnA.getStatus()==9) {//일반글인 경우 %> 
										삭제된 글입니다.
										<%} else {%>
											<a href="<%=request.getContextPath()%>/index.jsp?workgroup=board/QnA&work=QnA_detail&num=<%=QnA.getNum()%>&pageNum=<%=pageNum%>"><%=QnA.getTitle() %></a>
										<%} %>
										<%-- <% if(QnA.getStatus()==0) {//일반글인 경우 %> 
										<a href="<%=request.getContextPath()%>/index.jsp?workgroup=board/QnA&work=QnA_detail&num=<%=QnA.getNum()%>&pageNum=<%=pageNum%>"><%=QnA.getTitle() %></a> 
										<% } else if(QnA.getStatus()==1) {//비밀글%> 
										<% if(loginUser!=null && (QnA.getId().equals(loginUser.getId()) || loginUser.getStatus()==9)) { %> 
										<a href="<%=request.getContextPath()%>/index.jsp?workgroup=board/QnA&work=QnA_detail&num=<%=QnA.getNum()%>&pageNum=<%=pageNum%>">작성자 또는 관리자만 확인 가능합니다.</a> 
										<% } else { %> 작성자 또는 관리자만 확인 가능합니다. <% } %> 
										<% } else if(QnA.getStatus()==9) {//삭제글인 경우 %> <span class="remove">삭제글</span> 작성자 또는 관리자에 의해 삭제된 게시글입니다. <% } %> --%>
									 	
									 	
									<%--추가함 ->관리자 볼수 있게 하려고 --%> 	
										 <% if(loginUser1!=null) { %> 
										 
										 	<% if( (QnA.getId().equals(loginUser1.getId()) || loginUser1.getStatus()==9)) {%>
										<%-- <% if(QnA.getId().equals(loginUser1.getId()) || loginUser1.getStatus()==9) { %> --%>
										<a href="<%=request.getContextPath()%>/index.jsp?workgroup=board/QnA&work=QnA_detail&num=<%=QnA.getNum()%>&pageNum=<%=pageNum%>"></a>
									
										<%} %>	<%} %>
									</td>
									


									<% if(QnA.getStatus()!=9) {//삭제글이 아닌 경우 %>
									<%-- 문의상태 --%>
								
									<td align="center"><%=QnA.getInquiry() %></td>
							

									<% } else {//삭제글인 경우 %>
									<td>&nbsp;</td>
									<td>&nbsp;</td>
									<td>&nbsp;</td>
								<% } %>	<% } %>	<% } %>	
									
							</tbody>
						</table>
					</div>
					<%-- 페이지 번호 출력(페이징 처리) 및 하이퍼 링크 --%>
					<%
						//페이지 블럭에 출력될 페이지 번호의 갯수를 설정하여 저장
						int blockSize=5;//블럭에 출력될 페이지 번호의 갯수를 저장하기 위한 변수
	
						//페이지 블럭에 출력될 시작 페이지 번호를 계산하여 출력
						// => 1 Block(1~5) : 1, 2 Block(6~10) : 6, 3 Block(11~15) : 11, 4(16~20) Block : 16,... 
						int startPage=(pageNum-1)/blockSize*blockSize+1;//블럭에 출력될 페이지 시작 페이지번호를 저장하기 위한 변수
	
						//페이지 블럭에 출력될 마지막 페이지 번호를 계산하여 출력
						// => 1 Block(1~5) : 5, 2 Block(6~10) : 10, 3 Block(11~15) : 15, 4(16~20) Block : 20,...
						int endPage=startPage+blockSize-1;
						
						//마지막 페이지 블럭의 페이지 번호 변경
						if(endPage>totalPage) {
							endPage=totalPage;
						}
					%>

					<%-- 페이지 번호 출력 및 하이퍼 링크 --%>
					<div class="paging">
						<% if(startPage>blockSize) { %>
							<a href="<%=request.getContextPath()%>/index.jsp?workgroup=board/QnA&work=QnA_list&pageNum=1">[처음]</a>
							<a href="<%=request.getContextPath()%>/index.jsp?workgroup=board/QnA&work=QnA_list&pageNum=<%=startPage-blockSize%>">[이전]</a>
						<% } else { %>
							[처음][이전]
						<% } %>
	
						<% for(int i=startPage;i<=endPage;i++) { %>
						<% if(pageNum!=i) { %>
							<a href="<%=request.getContextPath()%>/index.jsp?workgroup=board/QnA&work=QnA_list&pageNum=<%=i%>">[<%=i %>]</a>
						<% } else { %>
							<span style="font-weight: bold; color: red;">[<%=i %>]</span>
						<% } %>
						<% } %>
	
						<% if(endPage!=totalPage) { %>
							<a href="<%=request.getContextPath()%>/index.jsp?workgroup=board/QnA&work=QnA_list&pageNum=<%=startPage+blockSize%>">[다음]</a>
							<a href="<%=request.getContextPath()%>/index.jsp?workgroup=board/QnA&work=QnA_list&pageNum=<%=totalPage%>">[마지막]</a>
						<% } else { %>
							[다음][마지막]
						<% } %>
					</div>
					<br>
				</div>
			</div>

		</div>
</div>
</body>
</html>