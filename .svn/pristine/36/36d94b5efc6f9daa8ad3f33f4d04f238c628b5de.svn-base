
<%@page import="site.itwill.dao.FAQDAO"%>
<%@page import="site.itwill.dto.FAQDTO"%>
<%@page import="site.itwill.dto.LushUserDTO"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@include file="/security/login_status.jspf" %>
<%-- 게시글 번호를 전달받아 FAQ 테이블에 저장된 게시글을 검색하여 응답하는 JSP 문서 --%>
<%-- => [글삭제]를 클릭한 경우 게시글 삭제 처리페이지(FAQ_remove_action.jsp)로 이동 --%>
<%-- => [글변경]을 클릭한 경우 게시글 변경 입력페이지(FAQ_modify.jsp)로 이동 --%>
<%-- => [답글쓰기]를 클릭한 경우 게시글 입력페이지(FAQ_write.jsp)로 이동 --%>
<%-- => [게시글목록]을 클릭한 경우 게시글 목록 출력페이지(FAQ_list.jsp)로 이동 --%>
<%
//POST 방식으로 요청되어 전달된 값들에 대한 캐릭터셋 변경
	request.setCharacterEncoding("UTF-8");

	LushUserDTO loginUser1=(LushUserDTO)session.getAttribute("loginUser");

	//비정상적인 요청에 대한 응답 처리
	// => 전달값이 존재하지 않을 경우	
	if(request.getParameter("num")==null) {
		out.println("<script>");
		out.println("location.href='"+request.getContextPath()+"/index.jsp?workgroup=board/FAQ&work=FAQ_list';");
		out.println("</script>");
		return;
	}
	
	//전달값을 반환받아 저장
	int num=Integer.parseInt(request.getParameter("num"));
	String pageNum=request.getParameter("pageNum");
	
	//게시글 번호를 전달하여 FAQ 테이블에 저장된 게시글을 검색하여 반환하는 DAO 클래스의 메소드 호출
	FAQDTO FAQ=FAQDAO.getDAO().getFAQ(num);
	/*
	//비정상적인 요청에 대한 응답 처리
	// => 검색된 게시글이 없거나 삭제된 게시글인 경우
	if(FAQ==null || FAQ.getStatus()==9) {
		out.println("<script>");
		out.println("location.href='"+request.getContextPath()+"/index.jsp?workgroup=board/FAQ&work=FAQ_list';");
		out.println("</script>");
		return;
	}*/

	//세션으로 공유된 인증정보를 반환받아 저장
	//LushUserDTO loginUser1=(LushUserDTO)session.getAttribute("loginUser1");
	
	
		//비정상적인 요청에 대한 응답 처리
		// => 현재 로그인 사용자가 작성자가 아니거나 관리자인 아닌 경우
		/* if(loginUser1==null || !loginUser1.getId().equals(FAQ.getId()) && loginUser1.getStatus()!=9) {
			out.println("<script>");
			out.println("location.href='"+request.getContextPath()+"/index.jsp?workgroup=board/FAQ&work=FAQ_list';");
			out.println("</script>");
			return;			
		} */
%> 
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<style type="text/css">
#wrapper {
	width: 500px;
	margin: 30px 50px 100px 500px;
}


table {
	text-align:center;
	border: 1px solid black;
	border-collapse: collapse; 
}

th, td {
	border: 1px solid black;
	padding: 5px;
}

th { width: 100px; }

td { width: 400px; }

.subject, .content { text-align: left; }

.content {
	height: 100px;
	vertical-align: middle;
}

#FAQ_menu {
	width:80%;
	text-align: center;
	margin: 5px 5px 5px 50px;
}
#content {
	width:80%;
	text-align: center;
}

listBtn:focus {outline:none;}
#listBtn{
	
}
</style>

<div id="wrapper">
	<h2>게시글</h2>
	<br>
	<table>
		<tr>
			<th>카테고리</th>
			<td>
				<%=FAQ.getCategory() %>
								
			</td>
		</tr>
		<tr>
			<th>내용</th>
			<td class="content">
				<%=FAQ.getContent().replace("\n", "<br>") %>
			</td>
		</tr>
	</table>
	
	<div id="FAQ_menu">
	
	<% if(loginUser1 != null && loginUser1.getId().equals(FAQ.getId())) { %>
		<button type="button" id="removeBtn">글삭제</button>
		
	<% } %>	
	<!-- <button type="button" id="replyBtn">답글쓰기</button> -->
	<br>
	<button type="button" id="listBtn">게시글목록</button>
	</div>
</div>

<form id="FAQForm" method="post">
	<input type="hidden" name="num" value="<%=num%>">
	<input type="hidden" name="pageNum" value="<%=pageNum%>">
</form>

<script type="text/javascript">
$("#removeBtn").click(function() {
	if(confirm("정말로 삭제 하시겠습니까?")) {
		$("#FAQForm").attr("action", "<%=request.getContextPath()%>/board/FAQ/FAQ_remove_action.jsp");
		$("#FAQForm").submit();
	}
});

 $("#listBtn").click(function() {
	$("#FAQForm").attr("action", "<%=request.getContextPath()%>/index.jsp?workgroup=board/FAQ&work=FAQ_List");
	$("#FAQForm").submit();
});
</script>
